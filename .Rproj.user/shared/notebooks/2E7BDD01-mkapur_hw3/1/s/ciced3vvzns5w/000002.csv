"0","setwd(""~/GitHub/FISH-559/Home3"")"
"2","The working directory was changed to C:/Users/mkapur/Documents/GitHub/FISH-559/Home3 inside a notebook chunk. The working directory will be reset when the chunk is finished running. Use the knitr root.dir option in the setup chunk to change the working directory for notebook chunks."
"0","dat <- read.table(""HOME3.txt"", header = T)"
"0","doNage <- function(nages = 21,"
"0","                   Fv = 0,"
"0","                   M = 0.15) {"
"0","    N_a <- Z_a <- matrix(NA, nrow = nages, ncol = 1)"
"0","    for(a in 1:nages){"
"0","      Z_a[a] <- M + sel[a]*Fv"
"0","      if(a > 1  & a < max(nages)) N_a[a] <- N_a[a-1]*exp(-Z_a[a-1])"
"0","      if(a == max(nages)) N_a[a] <-  N_a[a-1]*exp(-Z_a[a-1])/(1- exp(-Z_a[a]))"
"0","    }"
"0","    return(cbind(N_a,Z_a))"
"0","}"
"0","doYPR <-"
"0","  function(nages = length(unique(dat$Age)),"
"0","  selex = list(dat$Sel.f., dat$Sel.m.),"
"0","  Fv = 0, M = 0.15 ) {"
"0","  ypr <- matrix(NA, nrow = nages, ncol = 2)"
"0","  for(i in 1:2){"
"0","    wt <- wts[[i]]"
"0","    nzmat <-  doNage(sel = selex[[i]], Fv = Fv)"
"0","      n_a <- nzmat[,1]"
"0","    ypr[,i] <- wt*(( selex[[i]]*Fv)/z_a)*n_a*(1-exp(-z_a))"
"0","  }"
"0","}"
"0","getAB <- function(SRR = 1, h = 0.5, R0 = 1,fec = dat$Fecundity, gam = 1){"
"0","  sbpr0 <-"
"0","    sum(fec * doNage(Fv = 0, "
"0","                     sel = list(dat$Sel.f., dat$Sel.m.)[[1]])[, 1])"
"0","   if(SRR == 1){ "
"0","    alpha <- sbpr0*((1-h)/(4*h))"
"0","    beta <- (5*h-1)/(4*h*R0) "
"0","  } else  if(SRR == 2){"
"0","    alpha <- exp(log(5*h)/0.8)/sbpr0"
"0","    beta <- log(5*h)/(0.8*sbpr0*R0)"
"0","  } else   if(SRR == 3){"
"0","    alpha <- 1/sbpr0"
"0","    beta <- (5*h-1)/(1 - 0.2^gam) "
"0","  }"
"0","  return(c(""alpha"" = alpha, ""beta"" = beta))"
"0","}"
"0","doSRR <- function(fec = dat$Fecundity, SRR = 1, h = 0.5, Fv = 0, gam = 1, R0 = 1, S0 = 0.6739975){"
"0","  ## get s-tilde"
"0","  sbpr <- fec*doNage(Fv = Fv, sel=  list(dat$Sel.f.,dat$Sel.m.)[[1]])[,1] "
"0","  sumSBPR <- sum(sbpr)"
"0","    ab <- getAB(SRR = 1, h = h)"
"0","  } else if(SRR == 2){ ## ricker"
"0","    ab <- getAB(SRR = 2, h = h)"
"0","    R <- log(ab[1]*sumSBPR)/(ab[2]*sumSBPR) ## Question 1A"
"0","  } else if(SRR == 3){ ## Pella"
"0","    ab <- getAB(SRR = 3, h = h)"
"0","  }"
"0","  return(c('rec' = as.numeric(R),'spawnbio' = sumSBPR))"
"0","}"
"0","doYield <- function(ypr, R){"
"0","  yield <- ypr*R"
"0","  return(c(""yield"" = yield))"
"0","} "
"0","  "
"0","## put it all together"
"0","masterFunc <-"
"0","  function(nages = 21,"
"0","  selex = list(dat$Sel.f., dat$Sel.m.),"
"0","  wts = list(dat$Wght.f., dat$Wght.m.),"
"0","  SRR = 1,"
"0","  h = 0.5,"
"0","  gam = 1,"
"0","  R0 = 1,"
"0","  S0 = 0.6739975) {"
"0","  "
"0","  ypr <- doYPR(nages = nages, selex = selex, wts = wts, Fv = Fv)"
"0","  rec <-  doSRR( fec = dat$Fecundity,SRR = SRR, h = h, Fv = Fv,gam = gam, R0 = R0,S0 = S0)"
"0","  "
"0","  yield <- doYield(ypr,rec[1])"
"0","  "
"0","    ""Fmort"" = Fv,"
"0","    ""yield"" = yield,"
"0","  return(df)"
